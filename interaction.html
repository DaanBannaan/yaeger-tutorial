<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Adding interaction through collision detection - Yaeger Tutorial - Creating Waterworld</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A tutorial for Waterworld, a simple game based on Yaeger ">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Yaeger Tutorial - Creating Waterworld</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/han-yaeger/yaeger-tutorial" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="add-interaction-through-collision-detection"><a class="header" href="#add-interaction-through-collision-detection">Add interaction through collision detection</a></h1>
<p>A standard feature of a game engine is <em>collision detection</em>. It is an
algorithmically complex calculation that determines if any two entities occupy
the same part of the screen. If so, they have collided.</p>
<p>Yaeger differentiates between entities that need to be notified about a
collision (a <code>Collided</code>), and those that do not need to be notified (a
<code>Collider</code>). Think of this as a train and a fly. If they collide, the train
doesn't even notice it; the fly does (and dies).</p>
<p>With this approach, it is possible to minimize the number of entities that need
to be checked for collisions every GWU, and it also enables a good
Object-Oriented approach to place the responsibility of handling a collision on
the right entity.</p>
<h2 id="add-collision-detection-for-hanny-and-the-swordfish"><a class="header" href="#add-collision-detection-for-hanny-and-the-swordfish">Add collision detection for Hanny and the swordfish</a></h2>
<p>The swordfish is a dangerous foe and each time Hanny collides with him, she will
lose a life point. At the start of the game Hanny has ten of those and when she
reaches zero, she dies, and it is Game Over.</p>
<p>There are several algorithms for collision detection but Yaeger only supports
the simplest implementation, which is based on the <em>Bounding Box</em> of an entity.
This method is called <em>Axis Aligned Bounding Box</em> (AABB) collision detection and
is implemented through the interfaces <code>Collided</code> and <code>Collider</code>.</p>
<p><img src="images/edit.png" alt="Edit" /> Add the correct interface to Hanny and the swordfish.
You do not yet need to implement the event handler, but for testing purposes you
should add a <code>System.out.println("Collision!");</code></p>
<p><img src="images/play.png" alt="Run" /> Start the game and test if the collision has been
detected. To get more insight into these collisions, it is possible to run
Yaeger with the commandline argument <code>--showBB</code>, which makes all bounding boxes
visible.</p>
<blockquote>
<p>You might have noticed that because Yaeger uses the Bounding Box to check for
collisions, the collision detection is not as accurate as you might like it to
be. This can be solved by using the notion of a <em>hitbox</em>, a shape that defines
the area that is being checked during a collision detection cycle.</p>
<p>We will first finish implementing what happens after a collision. In the next
chapter we will rework the swordfish to a version where only the sword causes
a collision.</p>
</blockquote>
<h2 id="let-hanny-respawn-after-a-collision-with-the-swordfish"><a class="header" href="#let-hanny-respawn-after-a-collision-with-the-swordfish">Let Hanny respawn after a collision with the swordfish</a></h2>
<p>Because Hanny is the one who needs to know if she has collided with the
swordfish, she will be the one who implements <code>Collided</code>. We are going to
use the event handler to let Hanny respawn at a different location, using
her <code>setAnchorLocation()</code> method.</p>
<p><img src="images/edit.png" alt="Edit" /> Use the following event handler to let Hanny respawn at
a random location:</p>
<pre><code class="language-java">@Override
public void onCollision(List&lt;Collider&gt; collidingObject){
    setAnchorLocation(
        new Coordinate2D(new Random().nextInt((int)(getSceneWidth() 
        - getWidth())),
        new Random().nextInt((int)(getSceneHeight() - getHeight())))
    );
}
</code></pre>
<p>Notice that we have access to the <em>SceneWidth</em> and <em>SceneHeight</em> and that we
subtract, respectively, the <em>width</em> and <em>height</em> of Hanny to ensure that
Hanny respawns within the scene.</p>
<h2 id="add-health-points-and-subtract-one-on-a-collision"><a class="header" href="#add-health-points-and-subtract-one-on-a-collision">Add health points and subtract one on a collision</a></h2>
<p>The next step should be fairly simple, since we will use only features we have
already seen.</p>
<p><img src="images/edit.png" alt="Edit" /> Create a new static <code>TextEntity</code> called <code>HealthText</code>
with the constructor and method shown below. Add it to the
package <code>com.github.hanyaeger.tutorial.entities.text</code>.</p>
<pre><code class="language-java">public HealthText(Coordinate2D initialLocation){
    super(initialLocation);

    setFont(Font.font("Roboto",FontWeight.NORMAL, 30));
    setFill(Color.DARKBLUE);
}

public void setHealthText(int health){
    setText("Health: " + health);
}
</code></pre>
<p><img src="images/edit.png" alt="Edit" /> Add this entity to <code>GameLevel</code>, by using  the
<code>setupEntities()</code> method, but also pass the instance to the constructor of
Hanny. This way, Hanny has access to the <code>HealthText</code> entity and can call the
method <code>setHealthText(int)</code> whenever her health changes.</p>
<p><img src="images/edit.png" alt="Edit" /> Give Hanny a private instance field called health of
type <code>int</code> and initialize it to 10. Also bind the constructor
parameter <code>HealthText</code> to an instance field. After this change, the
constructor and instance fields of Hanny should look like:</p>
<pre><code class="language-java">private HealthText healthText;
private int health = 10;

public Hanny(Coordinate2D location, HealthText healthText){
    super("sprites/hanny.png", location, new Size(20,40), 2);

    this.healthText = healthText;
    healthText.setHealthText(health);

    setGravityConstant(0.005);
    setFrictionConstant(0.04);
}
</code></pre>
<p>The last step is to integrate the health into the event handler of Hanny.</p>
<p><img src="images/edit.png" alt="Edit" /> Change the event handler to ensure that the health is
decreased, and the <code>healthText</code> changed:</p>
<pre><code class="language-java">@Override
public void onCollision(List&lt;Collider&gt; collidingObject){
    setAnchorLocation(new Coordinate2D(
        new Random().nextInt((int)(getSceneWidth()-getWidth())),
        new Random().nextInt((int)(getSceneHeight()-getHeight())))
    );

    health--;
    healthText.setHealthText(health);
}
</code></pre>
<h2 id="add-a-game-over-scene-for-when-health-reaches-zero"><a class="header" href="#add-a-game-over-scene-for-when-health-reaches-zero">Add a Game Over-scene for when health reaches zero</a></h2>
<p>When health reaches 0 Hanny dies, and the player should see a new scene
containing the text <em>Game Over</em>, with below it the clickable text <em>Play
again</em>. We have seen all of Yaeger's features that are required for this, so
it should be clear how to implement this.</p>
<p><img src="images/edit.png" alt="Edit" /> Add a <em>Game Over</em> scene with a <em>Play Again</em> button.
Clicking the <em>Play Again</em> button should load the Game Level Scene.</p>
<p><img src="images/edit.png" alt="Edit" /> Change the event handler in Hanny in such a way that
when the health reaches zero, the Game Over scene is loaded.</p>
<h2 id="add-a-quit-game-button-to-the-game-over-scene"><a class="header" href="#add-a-quit-game-button-to-the-game-over-scene">Add a quit game button to the game over scene</a></h2>
<p><img src="images/edit.png" alt="Edit" /> Add a second button to the <em>Game Over</em> scene. Clicking
this button should quit Yaeger. The class <code>YaegerGame</code> provides a method to
quit the game, so use
the <a href="https://han-yaeger.github.io/yaeger/hanyaeger/com/github/hanyaeger/api/YaegerGame.html">JavaDoc</a>
to figure out which one it is.</p>
<p><img src="images/play.png" alt="Run" /> Run the game and test if the quit button works.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="player-controlled.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="interaction-with-hitboxes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="player-controlled.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="interaction-with-hitboxes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
