<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Adding more entities and an EntitySpawners - Yaeger Tutorial - Creating Waterworld</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A tutorial for Waterworld, a simple game based on Yaeger ">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Yaeger Tutorial - Creating Waterworld</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/han-yaeger/yaeger-tutorial" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="adding-more-entities-and-an-entityspawner"><a class="header" href="#adding-more-entities-and-an-entityspawner">Adding more entities and an <code>EntitySpawner</code></a></h1>
<h2 id="add-another-enemy-called-sharky"><a class="header" href="#add-another-enemy-called-sharky">Add another enemy, called Sharky</a></h2>
<p><img src="images/game/sharky.png" alt="Sharky" /></p>
<p>Not only the swordfish, but also another foe abides in the depth of the ocean:
the evil Sharky. As can be seen, Sharky swims from left to right and is composed
of many sprites. If these sprites are cycled at the correct speed, Sharky
becomes animated. To automatically cycle through the sprites,
a <code>DynamicSpriteEntity</code> provides the <code>setAutoCycle(long)</code> method.</p>
<p><img src="images/edit.png" alt="Edit" /> Add Sharky to <code>GameLevel</code>, animate him and let him
swim from left to right. After crossing the scene border, he should reappear
at a random location left of the screen. After colliding with Sharky, Hanny
loses a health point.</p>
<p><img src="images/play.png" alt="Run" /> Start the game and test if Sharky behaves as expected.</p>
<h2 id="add-air-and-poison-bubbles"><a class="header" href="#add-air-and-poison-bubbles">Add air and poison bubbles</a></h2>
<p>We are now going to add the game objective: Hanny is going to pop air bubbles.
They emerge from the depth of the ocean and float upwards at random speeds.
Some are filled with air, and some are filled with a poisonous gas. When Hanny
pops one of those, she loses a health point, but when she pops an air bubble,
her <em>bubbles popped</em> score increases, and she earns eternal fame.</p>
<h3 id="create-air-and-poison-bubbles"><a class="header" href="#create-air-and-poison-bubbles">Create air and poison bubbles</a></h3>
<p>For air- and poison bubbles we could provide two images of bubbles and use
a <code>DynamicSpriteEntity</code>, but we'll use a different approach. Yaeger provides
various entities for standard shapes and for a bubble we could perfectly use a
<code>DynamicCircleEntity</code>. With it, we can draw a circle and give it the appropriate
size and colors. The big advantage over using an image is that we can give it
any color and size we like, and change it while running the game. Even more
important, it will save on memory usage, since no images need to be loaded into
memory.</p>
<p>Because both air- and poison bubbles share much of their behaviour, a superclass
called <code>Bubble</code> would be the preferable approach, but it is not required. Their
interaction with Hanny will be of later concern.</p>
<p><img src="images/edit.png" alt="Edit" /> Create an <code>AirBubble</code> and a <code>PoisonBubble</code> that accept
both the <code>initialLocation</code> and the <code>speed</code> as a parameter of their constructor.
Do not yet add them to the scene. Use
the <a href="https://han-yaeger.github.io/yaeger/hanyaeger/com/github/hanyaeger/api/entities/impl/DynamicCircleEntity.html">API</a>
to figure out how to set the size and color (fill and stroke) of both
bubbles. Note that the <code>DynamicCircleEntity</code> inherits those methods from its
parent <code>ShapeEntity</code>, so look for the inherited methods in the JavaDoc.
Ensure you can differentiate between both bubbles.</p>
<p><img src="images/edit.png" alt="Edit" /> Use
the <a href="https://han-yaeger.github.io/yaeger/hanyaeger/com/github/hanyaeger/api/entities/impl/DynamicCircleEntity.html">API</a>
to figure out how to change their opacity to make them transparent.</p>
<blockquote>
<p>Besides the interface <code>DynamicCircleEntity</code>, Yaeger also contains a <code>DynamicRectangleEntity</code>, a <code>DynamicEllipseEntity</code>
and their static versions.</p>
</blockquote>
<h3 id="create-a-bubble-spawner"><a class="header" href="#create-a-bubble-spawner">Create a bubble spawner</a></h3>
<p>Because spawning entities into a level is a common feature of games, Yaeger
supports this through the class <code>EntitySpawner</code>. An <code>EntitySpawner</code> should
be extended and can then be added to a scene. The <code>EntitySpawner</code> will
create new instances of <code>YaegerEntity</code>and add them to the scene.</p>
<p>We are going to create a <code>BubbleSpawner</code> that can create both instances
of <code>AirBubble</code> and <code>PoisonBubble</code>.</p>
<p><img src="images/edit.png" alt="Edit" /> Create a class called <code>BubbleSpawner</code> that
extends <code>EntitySpawner</code> in the package
<code>com.github.hanyaeger.tutorial.spawners</code>. Notice that the constructor
of <code>EntitySpawner</code> accepts a parameter called <code>intervalInMs</code>. This parameter
will define the interval at which the method <code>spawnEntities()</code> is called. From
this method you can call <code>spawn(YaegerEntity)</code>.</p>
<h3 id="let-the-bubble-spawner-spawn-air-bubbles"><a class="header" href="#let-the-bubble-spawner-spawn-air-bubbles">Let the bubble spawner spawn air bubbles</a></h3>
<p>The <code>spawn(YaegerEntity)</code> method from the <code>BubbleSpawner</code> should be used for
spawning an entity. Furthermore, the <code>BubbleSpawner</code> should be able to place its
bubbles anywhere below the scene, so it should know the <em>width</em>
and <em>height</em> of the scene. To facilitate this, we are going to pass those two
values to the constructor.</p>
<p>We are going to start with spawning only instances of <code>AirBubble</code>.
The <code>PoisonBubble</code> will be added later on.</p>
<p><img src="images/edit.png" alt="Edit" /> Add the following body to the <code>BubbleSpawner</code>.</p>
<pre><code class="language-java">public class BubbleSpawner extends EntitySpawner {

    private final double sceneWidth;
    private final double sceneHeight;

    public BubbleSpawner(double sceneWidth, double sceneHeight) {
        super(100);
        this.sceneWidth = sceneWidth;
        this.sceneHeight = sceneHeight;
    }

    @Override
    protected void spawnEntities() {
        spawn(new AirBubble(randomLocation(), 2));
    }

    private Coordinate2D randomLocation() {
        double x = new Random().nextInt((int) sceneWidth);
        return new Coordinate2D(x, sceneHeight);
    }
}
</code></pre>
<h3 id="add-the-bubble-spawner-to-the-game-level"><a class="header" href="#add-the-bubble-spawner-to-the-game-level">Add the bubble spawner to the game level</a></h3>
<p>A <code>YaegerScene</code> does not support entity spawners by default. To enable it, the
scene needs to implement the interface <code>EntitySpawnerContainer</code>, which requires
implementing the method <code>setupEntitySpawners()</code>. From this method we can
call <code>addEntitySpawner(new BubbleSpawner(getWidth(), getHeight()));</code>, which
adds the entity spawner to the scene and ensures the spawned entities appear on
the scene.</p>
<p><img src="images/edit.png" alt="Edit" /> Add the <code>BubbleSpawner</code> to the <code>GameLevel</code>.</p>
<p><img src="images/play.png" alt="Run" /> Run the game to see if everything works as expected.</p>
<h3 id="make-the-bubble-spawner-also-spawn-instances-of-poisonbubble"><a class="header" href="#make-the-bubble-spawner-also-spawn-instances-of-poisonbubble">Make the bubble spawner also spawn instances of <code>PoisonBubble</code></a></h3>
<p>Let's change the <code>spawnEntities()</code> method to ensure that four out of ten spawned
bubbles will be a <code>PoisonBubble</code>. For this we can use the class <code>Random</code> from
the Java <a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Random.html">API</a>
.</p>
<p><img src="images/edit.png" alt="Edit" /> Change the <code>spawnEntities()</code> method to:</p>
<pre><code class="language-java">@Override
protected void spawnEntities(){
    if(new Random().nextInt(10) &lt; 4){
        spawn(new PoisonBubble(randomLocation(), 2));
    } else {
        spawn(new AirBubble(randomLocation(), 2));
    }
}
</code></pre>
<h3 id="make-the-bubbles-pop-if-they-collide-with-hanny"><a class="header" href="#make-the-bubbles-pop-if-they-collide-with-hanny">Make the bubbles pop if they collide with Hanny</a></h3>
<p>Whenever a bubble collides with Hanny, a popping sound should be played, and
the bubble should disappear (by removing it from the scene). We have already seen how to approach
this. Apparently the bubble needs to be notified when something collides with
it. Remember the interface <code>Collided</code>? But then, this is only applicable if the
entity that collides with it, becomes a <code>Collider</code>. So Hanny will not only be
a <code>Collided</code>, but also a <code>Collider</code>!</p>
<p><img src="images/edit.png" alt="Edit" /> Add the interface <code>Collider</code> to Hanny.</p>
<p><img src="images/edit.png" alt="Edit" /> Add the interface <code>Collided</code> to the <code>PoisonBubble</code>
and <code>AirBubble</code> (since this is shared behaviour, and we are doing proper object
orientation, we will add it to their superclass). Implement the event handler in
the following way:</p>
<pre><code class="language-java">@Override
public void onCollision(List&lt;Collider&gt; collidingObject){
    var popSound = new SoundClip("audio/pop.mp3");
    popSound.play();

    remove();
}
</code></pre>
<p>Notice that we create a <code>SoundClip</code> and call its method <code>play()</code> to create the
pop-sound. The <code>remove()</code> method is available on all entities and ensures they
are removed from the scene.</p>
<h3 id="remove-the-bubbles-if-they-leave-the-scene"><a class="header" href="#remove-the-bubbles-if-they-leave-the-scene">Remove the bubbles if they leave the scene</a></h3>
<p>Bubbles that leave the scene should still be removed, otherwise they will float
on for ever and consume an increasing amount of memory, bringing even the
fastest computer to a grinding halt. We have already seen everything needed to
accomplish this.</p>
<p><img src="images/edit.png" alt="Edit" /> Add the interface <code>SceneBorderCrossingWatcher</code> to
the <code>PoisonBubble</code> and <code>AirBubble</code>, and call the method <code>remove()</code> from the
event handler. Do make sure you call this method only when the top-border has
been crossed.</p>
<p><img src="images/play.png" alt="Run" /> Run the game and use the debugger to see if the bubbles
that leave the top of the screen are actually removed (and garbage collected).</p>
<h3 id="remove-a-health-point-when-hanny-collides-with-a-poisonbubble"><a class="header" href="#remove-a-health-point-when-hanny-collides-with-a-poisonbubble">Remove a health point when Hanny collides with a <code>PoisonBubble</code></a></h3>
<p>Whenever Hanny collides with a <code>PoisonBubble</code>, one health point should be
removed. Adding this shouldn't be too hard, since we have already seen
everything we need to accomplish this.</p>
<p><img src="images/edit.png" alt="Edit" /> Make Hanny lose a health point whenever she collides
with a <code>PoisonBubble</code>.</p>
<h3 id="add-a-bubbles-popped-counter-and-increase-it-whenever-hanny-pops-an-airbubble"><a class="header" href="#add-a-bubbles-popped-counter-and-increase-it-whenever-hanny-pops-an-airbubble">Add a Bubbles Popped counter and increase it whenever Hanny pops an <code>AirBubble</code></a></h3>
<p>Just like the health counter, shown at the top of the screen, we are going
to add a <em>Bubbles Popped</em> counter. Again, something we have done before, so it
shouldn't be too hard. The main question will be which entity is <strong>responsible</strong>
for changing the <em>Bubbles Popped</em> counter. Is it Hanny, or are the air bubbles
responsible for this?</p>
<p>In this case we are going to model it by letting Hanny know how many bubbles she
has popped. This way the implementation can mirror that of the <code>HealthText</code>. The
main difference will be that the event handler for collision will have to
differentiate between an <code>AirBubble</code> and other entities.</p>
<p><img src="images/edit.png" alt="Edit" /> Implement a new <code>TextEntity</code> for the <em>Bubbles Popped</em>
text. This should be analogue to the way the health counter was implemented.
Think about which entities need to become a <code>Collider</code> and implement the event
handler for collisions on Hanny in the following way:</p>
<pre><code class="language-java">@Override
public void onCollision(List&lt;Collider&gt; collidingObject) {
    var airBubbleCollision = false;
    var enemyCollision = false;

    for (Collider collider : collidingObject) {
        if (collider instanceof AirBubble) {
            airBubbleCollision = true;
        } else {
            enemyCollision = true;
        }
    }
    
    if (airBubbleCollision) {
        bubblesPoppedText.setText(++bubblesPopped);
    }
    if (enemyCollision) {
        healthText.setText(--health);

        if (health == 0) {
            this.waterworld.setActiveScene(2);
        } else {
            setAnchorLocation(new Coordinate2D(
                new Random().nextInt((int) (getSceneWidth() - getWidth())),
                new Random().nextInt((int) (getSceneHeight() - getHeight()))));
        }
    }
}
</code></pre>
<h2 id="apply-some-proper-object-orientation"><a class="header" href="#apply-some-proper-object-orientation">Apply some proper Object Orientation</a></h2>
<p>When you followed the steps above you might have implemented the <code>Collider</code>
interface in the <code>AirBubble</code> class as well as in the <code>PoisonBubble</code> class.
Again shared behaviour, so it's time to clean that up.</p>
<p><img src="images/edit.png" alt="Edit" /> Create a superclass for both <code>AirBubble</code>
and <code>PoisonBubble</code> and move all their shared behaviour to this superclass.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="interaction-with-hitboxes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="tilemaps.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="interaction-with-hitboxes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="tilemaps.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
